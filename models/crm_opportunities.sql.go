// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: crm_opportunities.sql

package models

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const crmAnyOpportunity = `-- name: CrmAnyOpportunity :many
select
  opportunities.id, opportunities.name, opportunities.stage, opportunities.deal_value, opportunities.probability, opportunities.expected_close_date, opportunities.lost_reason, opportunities.source, opportunities.owner_id, opportunities.contact_id, opportunities.company_id, opportunities.campaign_id, opportunities.created_at, opportunities.updated_at, opportunities.products,
  owner.id, owner.name, owner.email, owner.email_verified, owner.image, owner.created_at, owner.updated_at, owner.role, owner.banned, owner.ban_reason, owner.ban_expires,
  contact.id, contact.name, contact.email, contact.phone_number, contact.job_title, contact.company_id, contact.owner_id, contact.created_at, contact.updated_at,
  company.id, company.name, company.street, company.city, company.state, company.postal_code, company.country, company.phone_number, company.industry, company.website, company.annual_revenue, company.owner_id, company.created_at, company.updated_at,
  campaign.id, campaign.name, campaign.budget, campaign.start_date, campaign.end_date, campaign.created_at, campaign.updated_at
from
  "crm"."opportunities_view" as opportunities
  inner join "public"."user" as owner on opportunities.owner_id = owner.id
  left join "crm"."contacts" as contact on opportunities.contact_id = contact.id
  left join "crm"."companies" as company on opportunities.company_id = company.id
  left join "crm"."campaigns" as campaign on opportunities.campaign_id = campaign.id
where
  opportunities.id = any ($1::uuid[])
`

type CrmAnyOpportunityRow struct {
	CrmOpportunitiesView CrmOpportunitiesView `db:"crm_opportunities_view" json:"crm_opportunities_view"`
	User                 User                 `db:"user" json:"user"`
	CrmContact           CrmContact           `db:"crm_contact" json:"crm_contact"`
	CrmCompany           CrmCompany           `db:"crm_company" json:"crm_company"`
	CrmCampaign          CrmCampaign          `db:"crm_campaign" json:"crm_campaign"`
}

func (q *Queries) CrmAnyOpportunity(ctx context.Context, ids []pgtype.UUID) ([]CrmAnyOpportunityRow, error) {
	rows, err := q.db.Query(ctx, crmAnyOpportunity, ids)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []CrmAnyOpportunityRow
	for rows.Next() {
		var i CrmAnyOpportunityRow
		if err := rows.Scan(
			&i.CrmOpportunitiesView.ID,
			&i.CrmOpportunitiesView.Name,
			&i.CrmOpportunitiesView.Stage,
			&i.CrmOpportunitiesView.DealValue,
			&i.CrmOpportunitiesView.Probability,
			&i.CrmOpportunitiesView.ExpectedCloseDate,
			&i.CrmOpportunitiesView.LostReason,
			&i.CrmOpportunitiesView.Source,
			&i.CrmOpportunitiesView.OwnerID,
			&i.CrmOpportunitiesView.ContactID,
			&i.CrmOpportunitiesView.CompanyID,
			&i.CrmOpportunitiesView.CampaignID,
			&i.CrmOpportunitiesView.CreatedAt,
			&i.CrmOpportunitiesView.UpdatedAt,
			&i.CrmOpportunitiesView.Products,
			&i.User.ID,
			&i.User.Name,
			&i.User.Email,
			&i.User.EmailVerified,
			&i.User.Image,
			&i.User.CreatedAt,
			&i.User.UpdatedAt,
			&i.User.Role,
			&i.User.Banned,
			&i.User.BanReason,
			&i.User.BanExpires,
			&i.CrmContact.ID,
			&i.CrmContact.Name,
			&i.CrmContact.Email,
			&i.CrmContact.PhoneNumber,
			&i.CrmContact.JobTitle,
			&i.CrmContact.CompanyID,
			&i.CrmContact.OwnerID,
			&i.CrmContact.CreatedAt,
			&i.CrmContact.UpdatedAt,
			&i.CrmCompany.ID,
			&i.CrmCompany.Name,
			&i.CrmCompany.Street,
			&i.CrmCompany.City,
			&i.CrmCompany.State,
			&i.CrmCompany.PostalCode,
			&i.CrmCompany.Country,
			&i.CrmCompany.PhoneNumber,
			&i.CrmCompany.Industry,
			&i.CrmCompany.Website,
			&i.CrmCompany.AnnualRevenue,
			&i.CrmCompany.OwnerID,
			&i.CrmCompany.CreatedAt,
			&i.CrmCompany.UpdatedAt,
			&i.CrmCampaign.ID,
			&i.CrmCampaign.Name,
			&i.CrmCampaign.Budget,
			&i.CrmCampaign.StartDate,
			&i.CrmCampaign.EndDate,
			&i.CrmCampaign.CreatedAt,
			&i.CrmCampaign.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const crmFindOpportunity = `-- name: CrmFindOpportunity :one
select
  opportunities.id, opportunities.name, opportunities.stage, opportunities.deal_value, opportunities.probability, opportunities.expected_close_date, opportunities.lost_reason, opportunities.source, opportunities.owner_id, opportunities.contact_id, opportunities.company_id, opportunities.campaign_id, opportunities.created_at, opportunities.updated_at, opportunities.products,
  owner.id, owner.name, owner.email, owner.email_verified, owner.image, owner.created_at, owner.updated_at, owner.role, owner.banned, owner.ban_reason, owner.ban_expires,
  contact.id, contact.name, contact.email, contact.phone_number, contact.job_title, contact.company_id, contact.owner_id, contact.created_at, contact.updated_at,
  company.id, company.name, company.street, company.city, company.state, company.postal_code, company.country, company.phone_number, company.industry, company.website, company.annual_revenue, company.owner_id, company.created_at, company.updated_at,
  campaign.id, campaign.name, campaign.budget, campaign.start_date, campaign.end_date, campaign.created_at, campaign.updated_at
from
  "crm"."opportunities_view" as opportunities
  inner join "public"."user" as owner on opportunities.owner_id = owner.id
  left join "crm"."contacts" as contact on opportunities.contact_id = contact.id
  left join "crm"."companies" as company on opportunities.company_id = company.id
  left join "crm"."campaigns" as campaign on opportunities.campaign_id = campaign.id
where
  opportunities.id = $1::uuid
`

type CrmFindOpportunityRow struct {
	CrmOpportunitiesView CrmOpportunitiesView `db:"crm_opportunities_view" json:"crm_opportunities_view"`
	User                 User                 `db:"user" json:"user"`
	CrmContact           CrmContact           `db:"crm_contact" json:"crm_contact"`
	CrmCompany           CrmCompany           `db:"crm_company" json:"crm_company"`
	CrmCampaign          CrmCampaign          `db:"crm_campaign" json:"crm_campaign"`
}

func (q *Queries) CrmFindOpportunity(ctx context.Context, id pgtype.UUID) (CrmFindOpportunityRow, error) {
	row := q.db.QueryRow(ctx, crmFindOpportunity, id)
	var i CrmFindOpportunityRow
	err := row.Scan(
		&i.CrmOpportunitiesView.ID,
		&i.CrmOpportunitiesView.Name,
		&i.CrmOpportunitiesView.Stage,
		&i.CrmOpportunitiesView.DealValue,
		&i.CrmOpportunitiesView.Probability,
		&i.CrmOpportunitiesView.ExpectedCloseDate,
		&i.CrmOpportunitiesView.LostReason,
		&i.CrmOpportunitiesView.Source,
		&i.CrmOpportunitiesView.OwnerID,
		&i.CrmOpportunitiesView.ContactID,
		&i.CrmOpportunitiesView.CompanyID,
		&i.CrmOpportunitiesView.CampaignID,
		&i.CrmOpportunitiesView.CreatedAt,
		&i.CrmOpportunitiesView.UpdatedAt,
		&i.CrmOpportunitiesView.Products,
		&i.User.ID,
		&i.User.Name,
		&i.User.Email,
		&i.User.EmailVerified,
		&i.User.Image,
		&i.User.CreatedAt,
		&i.User.UpdatedAt,
		&i.User.Role,
		&i.User.Banned,
		&i.User.BanReason,
		&i.User.BanExpires,
		&i.CrmContact.ID,
		&i.CrmContact.Name,
		&i.CrmContact.Email,
		&i.CrmContact.PhoneNumber,
		&i.CrmContact.JobTitle,
		&i.CrmContact.CompanyID,
		&i.CrmContact.OwnerID,
		&i.CrmContact.CreatedAt,
		&i.CrmContact.UpdatedAt,
		&i.CrmCompany.ID,
		&i.CrmCompany.Name,
		&i.CrmCompany.Street,
		&i.CrmCompany.City,
		&i.CrmCompany.State,
		&i.CrmCompany.PostalCode,
		&i.CrmCompany.Country,
		&i.CrmCompany.PhoneNumber,
		&i.CrmCompany.Industry,
		&i.CrmCompany.Website,
		&i.CrmCompany.AnnualRevenue,
		&i.CrmCompany.OwnerID,
		&i.CrmCompany.CreatedAt,
		&i.CrmCompany.UpdatedAt,
		&i.CrmCampaign.ID,
		&i.CrmCampaign.Name,
		&i.CrmCampaign.Budget,
		&i.CrmCampaign.StartDate,
		&i.CrmCampaign.EndDate,
		&i.CrmCampaign.CreatedAt,
		&i.CrmCampaign.UpdatedAt,
	)
	return i, err
}

const crmInsertOpportunity = `-- name: CrmInsertOpportunity :one
insert into "crm"."opportunities_view"(name, stage, deal_value, probability, expected_close_date, lost_reason, source, owner_id, contact_id, company_id, campaign_id)
  values ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)
returning
  id, name, stage, deal_value, probability, expected_close_date, lost_reason, source, owner_id, contact_id, company_id, campaign_id, created_at, updated_at, products
`

type CrmInsertOpportunityParams struct {
	Name              string                   `db:"name" json:"name"`
	Stage             NullCrmOpportunityStage  `db:"stage" json:"stage"`
	DealValue         pgtype.Numeric           `db:"deal_value" json:"deal_value"`
	Probability       pgtype.Float4            `db:"probability" json:"probability"`
	ExpectedCloseDate pgtype.Date              `db:"expected_close_date" json:"expected_close_date"`
	LostReason        pgtype.Text              `db:"lost_reason" json:"lost_reason"`
	Source            NullCrmOpportunitySource `db:"source" json:"source"`
	OwnerID           string                   `db:"owner_id" json:"owner_id"`
	ContactID         pgtype.UUID              `db:"contact_id" json:"contact_id"`
	CompanyID         pgtype.UUID              `db:"company_id" json:"company_id"`
	CampaignID        pgtype.UUID              `db:"campaign_id" json:"campaign_id"`
}

func (q *Queries) CrmInsertOpportunity(ctx context.Context, arg CrmInsertOpportunityParams) (CrmOpportunitiesView, error) {
	row := q.db.QueryRow(ctx, crmInsertOpportunity,
		arg.Name,
		arg.Stage,
		arg.DealValue,
		arg.Probability,
		arg.ExpectedCloseDate,
		arg.LostReason,
		arg.Source,
		arg.OwnerID,
		arg.ContactID,
		arg.CompanyID,
		arg.CampaignID,
	)
	var i CrmOpportunitiesView
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Stage,
		&i.DealValue,
		&i.Probability,
		&i.ExpectedCloseDate,
		&i.LostReason,
		&i.Source,
		&i.OwnerID,
		&i.ContactID,
		&i.CompanyID,
		&i.CampaignID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.Products,
	)
	return i, err
}

const crmPaginateOpportunity = `-- name: CrmPaginateOpportunity :many
select
  count(*) over () as total_items,
  ceil(count(*) over ()::numeric / NULLIF($1::int, 0)) as total_pages,
  $2::int as page,
  $1::int as per_page,
  opportunities.id, opportunities.name, opportunities.stage, opportunities.deal_value, opportunities.probability, opportunities.expected_close_date, opportunities.lost_reason, opportunities.source, opportunities.owner_id, opportunities.contact_id, opportunities.company_id, opportunities.campaign_id, opportunities.created_at, opportunities.updated_at, opportunities.products,
  owner.id, owner.name, owner.email, owner.email_verified, owner.image, owner.created_at, owner.updated_at, owner.role, owner.banned, owner.ban_reason, owner.ban_expires,
  contact.id, contact.name, contact.email, contact.phone_number, contact.job_title, contact.company_id, contact.owner_id, contact.created_at, contact.updated_at,
  company.id, company.name, company.street, company.city, company.state, company.postal_code, company.country, company.phone_number, company.industry, company.website, company.annual_revenue, company.owner_id, company.created_at, company.updated_at,
  campaign.id, campaign.name, campaign.budget, campaign.start_date, campaign.end_date, campaign.created_at, campaign.updated_at
from
  "crm"."opportunities_view" as opportunities
  inner join "public"."user" as owner on opportunities.owner_id = owner.id
  left join "crm"."contacts" as contact on opportunities.contact_id = contact.id
  left join "crm"."companies" as company on opportunities.company_id = company.id
  left join "crm"."campaigns" as campaign on opportunities.campaign_id = campaign.id
where (opportunities.name ilike $3::text
  or opportunities.stage::text ilike $3::text
  or owner.name ilike $3::text
  or company.name ilike $3::text
  or contact.name ilike $3::text
  or campaign.name ilike $3::text
  or opportunities.source::text ilike $3::text
  or $3::text is null)
limit $1::int offset ($2::int - 1) * $1::int
`

type CrmPaginateOpportunityParams struct {
	PerPage int32       `db:"per_page" json:"per_page"`
	Page    int32       `db:"page" json:"page"`
	Search  pgtype.Text `db:"search" json:"search"`
}

type CrmPaginateOpportunityRow struct {
	TotalItems           int64                `db:"total_items" json:"total_items"`
	TotalPages           float64              `db:"total_pages" json:"total_pages"`
	Page                 int32                `db:"page" json:"page"`
	PerPage              int32                `db:"per_page" json:"per_page"`
	CrmOpportunitiesView CrmOpportunitiesView `db:"crm_opportunities_view" json:"crm_opportunities_view"`
	User                 User                 `db:"user" json:"user"`
	CrmContact           CrmContact           `db:"crm_contact" json:"crm_contact"`
	CrmCompany           CrmCompany           `db:"crm_company" json:"crm_company"`
	CrmCampaign          CrmCampaign          `db:"crm_campaign" json:"crm_campaign"`
}

func (q *Queries) CrmPaginateOpportunity(ctx context.Context, arg CrmPaginateOpportunityParams) ([]CrmPaginateOpportunityRow, error) {
	rows, err := q.db.Query(ctx, crmPaginateOpportunity, arg.PerPage, arg.Page, arg.Search)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []CrmPaginateOpportunityRow
	for rows.Next() {
		var i CrmPaginateOpportunityRow
		if err := rows.Scan(
			&i.TotalItems,
			&i.TotalPages,
			&i.Page,
			&i.PerPage,
			&i.CrmOpportunitiesView.ID,
			&i.CrmOpportunitiesView.Name,
			&i.CrmOpportunitiesView.Stage,
			&i.CrmOpportunitiesView.DealValue,
			&i.CrmOpportunitiesView.Probability,
			&i.CrmOpportunitiesView.ExpectedCloseDate,
			&i.CrmOpportunitiesView.LostReason,
			&i.CrmOpportunitiesView.Source,
			&i.CrmOpportunitiesView.OwnerID,
			&i.CrmOpportunitiesView.ContactID,
			&i.CrmOpportunitiesView.CompanyID,
			&i.CrmOpportunitiesView.CampaignID,
			&i.CrmOpportunitiesView.CreatedAt,
			&i.CrmOpportunitiesView.UpdatedAt,
			&i.CrmOpportunitiesView.Products,
			&i.User.ID,
			&i.User.Name,
			&i.User.Email,
			&i.User.EmailVerified,
			&i.User.Image,
			&i.User.CreatedAt,
			&i.User.UpdatedAt,
			&i.User.Role,
			&i.User.Banned,
			&i.User.BanReason,
			&i.User.BanExpires,
			&i.CrmContact.ID,
			&i.CrmContact.Name,
			&i.CrmContact.Email,
			&i.CrmContact.PhoneNumber,
			&i.CrmContact.JobTitle,
			&i.CrmContact.CompanyID,
			&i.CrmContact.OwnerID,
			&i.CrmContact.CreatedAt,
			&i.CrmContact.UpdatedAt,
			&i.CrmCompany.ID,
			&i.CrmCompany.Name,
			&i.CrmCompany.Street,
			&i.CrmCompany.City,
			&i.CrmCompany.State,
			&i.CrmCompany.PostalCode,
			&i.CrmCompany.Country,
			&i.CrmCompany.PhoneNumber,
			&i.CrmCompany.Industry,
			&i.CrmCompany.Website,
			&i.CrmCompany.AnnualRevenue,
			&i.CrmCompany.OwnerID,
			&i.CrmCompany.CreatedAt,
			&i.CrmCompany.UpdatedAt,
			&i.CrmCampaign.ID,
			&i.CrmCampaign.Name,
			&i.CrmCampaign.Budget,
			&i.CrmCampaign.StartDate,
			&i.CrmCampaign.EndDate,
			&i.CrmCampaign.CreatedAt,
			&i.CrmCampaign.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const crmRangeOpportunity = `-- name: CrmRangeOpportunity :many
select
  opportunities.id, opportunities.name, opportunities.stage, opportunities.deal_value, opportunities.probability, opportunities.expected_close_date, opportunities.lost_reason, opportunities.source, opportunities.owner_id, opportunities.contact_id, opportunities.company_id, opportunities.campaign_id, opportunities.created_at, opportunities.updated_at, opportunities.products,
  owner.id, owner.name, owner.email, owner.email_verified, owner.image, owner.created_at, owner.updated_at, owner.role, owner.banned, owner.ban_reason, owner.ban_expires,
  contact.id, contact.name, contact.email, contact.phone_number, contact.job_title, contact.company_id, contact.owner_id, contact.created_at, contact.updated_at,
  company.id, company.name, company.street, company.city, company.state, company.postal_code, company.country, company.phone_number, company.industry, company.website, company.annual_revenue, company.owner_id, company.created_at, company.updated_at,
  campaign.id, campaign.name, campaign.budget, campaign.start_date, campaign.end_date, campaign.created_at, campaign.updated_at
from
  "crm"."opportunities_view" as opportunities
  inner join "public"."user" as owner on opportunities.owner_id = owner.id
  left join "crm"."contacts" as contact on opportunities.contact_id = contact.id
  left join "crm"."companies" as company on opportunities.company_id = company.id
  left join "crm"."campaigns" as campaign on opportunities.campaign_id = campaign.id
where
  opportunities.created_at >= $1::date
  and opportunities.created_at <= $2::date
  and (opportunities.name ilike $3::text
    or opportunities.stage::text ilike $3::text
    or owner.name ilike $3::text
    or company.name ilike $3::text
    or contact.name ilike $3::text
    or campaign.name ilike $3::text
    or opportunities.source::text ilike $3::text
    or $3::text is null)
`

type CrmRangeOpportunityParams struct {
	Datefrom pgtype.Date `db:"datefrom" json:"datefrom"`
	Dateto   pgtype.Date `db:"dateto" json:"dateto"`
	Search   pgtype.Text `db:"search" json:"search"`
}

type CrmRangeOpportunityRow struct {
	CrmOpportunitiesView CrmOpportunitiesView `db:"crm_opportunities_view" json:"crm_opportunities_view"`
	User                 User                 `db:"user" json:"user"`
	CrmContact           CrmContact           `db:"crm_contact" json:"crm_contact"`
	CrmCompany           CrmCompany           `db:"crm_company" json:"crm_company"`
	CrmCampaign          CrmCampaign          `db:"crm_campaign" json:"crm_campaign"`
}

func (q *Queries) CrmRangeOpportunity(ctx context.Context, arg CrmRangeOpportunityParams) ([]CrmRangeOpportunityRow, error) {
	rows, err := q.db.Query(ctx, crmRangeOpportunity, arg.Datefrom, arg.Dateto, arg.Search)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []CrmRangeOpportunityRow
	for rows.Next() {
		var i CrmRangeOpportunityRow
		if err := rows.Scan(
			&i.CrmOpportunitiesView.ID,
			&i.CrmOpportunitiesView.Name,
			&i.CrmOpportunitiesView.Stage,
			&i.CrmOpportunitiesView.DealValue,
			&i.CrmOpportunitiesView.Probability,
			&i.CrmOpportunitiesView.ExpectedCloseDate,
			&i.CrmOpportunitiesView.LostReason,
			&i.CrmOpportunitiesView.Source,
			&i.CrmOpportunitiesView.OwnerID,
			&i.CrmOpportunitiesView.ContactID,
			&i.CrmOpportunitiesView.CompanyID,
			&i.CrmOpportunitiesView.CampaignID,
			&i.CrmOpportunitiesView.CreatedAt,
			&i.CrmOpportunitiesView.UpdatedAt,
			&i.CrmOpportunitiesView.Products,
			&i.User.ID,
			&i.User.Name,
			&i.User.Email,
			&i.User.EmailVerified,
			&i.User.Image,
			&i.User.CreatedAt,
			&i.User.UpdatedAt,
			&i.User.Role,
			&i.User.Banned,
			&i.User.BanReason,
			&i.User.BanExpires,
			&i.CrmContact.ID,
			&i.CrmContact.Name,
			&i.CrmContact.Email,
			&i.CrmContact.PhoneNumber,
			&i.CrmContact.JobTitle,
			&i.CrmContact.CompanyID,
			&i.CrmContact.OwnerID,
			&i.CrmContact.CreatedAt,
			&i.CrmContact.UpdatedAt,
			&i.CrmCompany.ID,
			&i.CrmCompany.Name,
			&i.CrmCompany.Street,
			&i.CrmCompany.City,
			&i.CrmCompany.State,
			&i.CrmCompany.PostalCode,
			&i.CrmCompany.Country,
			&i.CrmCompany.PhoneNumber,
			&i.CrmCompany.Industry,
			&i.CrmCompany.Website,
			&i.CrmCompany.AnnualRevenue,
			&i.CrmCompany.OwnerID,
			&i.CrmCompany.CreatedAt,
			&i.CrmCompany.UpdatedAt,
			&i.CrmCampaign.ID,
			&i.CrmCampaign.Name,
			&i.CrmCampaign.Budget,
			&i.CrmCampaign.StartDate,
			&i.CrmCampaign.EndDate,
			&i.CrmCampaign.CreatedAt,
			&i.CrmCampaign.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const crmRemoveOpportunity = `-- name: CrmRemoveOpportunity :exec
delete from "crm"."opportunities_view"
where id = $1::uuid
`

func (q *Queries) CrmRemoveOpportunity(ctx context.Context, id pgtype.UUID) error {
	_, err := q.db.Exec(ctx, crmRemoveOpportunity, id)
	return err
}

const crmUpdateOpportunity = `-- name: CrmUpdateOpportunity :one
update
  "crm"."opportunities_view"
set
  updated_at = now(),
  name = case when $1 is not null then
    $1::text
  else
    name
  end,
  stage = case when $2 is not null then
    $2::crm.opportunity_stage
  else
    stage
  end,
  deal_value = case when $3 is not null then
    $3::numeric
  else
    deal_value
  end,
  probability = case when $4 is not null then
    $4::real
  else
    probability
  end,
  expected_close_date = case when $5 is not null then
    $5::date
  else
    expected_close_date
  end,
  lost_reason = case when $6 is not null then
    $6::text
  else
    lost_reason
  end,
  source = case when $7 is not null then
    $7::crm.opportunity_source
  else
    source
  end,
  owner_id = case when $8 is not null then
    $8::text
  else
    owner_id
  end,
  contact_id = case when $9 is not null then
    $9::uuid
  else
    contact_id
  end,
  company_id = case when $10 is not null then
    $10::uuid
  else
    company_id
  end,
  campaign_id = case when $11 is not null then
    $11::uuid
  else
    campaign_id
  end
where
  id = $12::uuid
returning
  id, name, stage, deal_value, probability, expected_close_date, lost_reason, source, owner_id, contact_id, company_id, campaign_id, created_at, updated_at, products
`

type CrmUpdateOpportunityParams struct {
	Name              string                   `db:"name" json:"name"`
	Stage             NullCrmOpportunityStage  `db:"stage" json:"stage"`
	DealValue         pgtype.Numeric           `db:"deal_value" json:"deal_value"`
	Probability       pgtype.Float4            `db:"probability" json:"probability"`
	ExpectedCloseDate pgtype.Date              `db:"expected_close_date" json:"expected_close_date"`
	LostReason        pgtype.Text              `db:"lost_reason" json:"lost_reason"`
	Source            NullCrmOpportunitySource `db:"source" json:"source"`
	OwnerID           string                   `db:"owner_id" json:"owner_id"`
	ContactID         pgtype.UUID              `db:"contact_id" json:"contact_id"`
	CompanyID         pgtype.UUID              `db:"company_id" json:"company_id"`
	CampaignID        pgtype.UUID              `db:"campaign_id" json:"campaign_id"`
	ID                pgtype.UUID              `db:"id" json:"id"`
}

func (q *Queries) CrmUpdateOpportunity(ctx context.Context, arg CrmUpdateOpportunityParams) (CrmOpportunitiesView, error) {
	row := q.db.QueryRow(ctx, crmUpdateOpportunity,
		arg.Name,
		arg.Stage,
		arg.DealValue,
		arg.Probability,
		arg.ExpectedCloseDate,
		arg.LostReason,
		arg.Source,
		arg.OwnerID,
		arg.ContactID,
		arg.CompanyID,
		arg.CampaignID,
		arg.ID,
	)
	var i CrmOpportunitiesView
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Stage,
		&i.DealValue,
		&i.Probability,
		&i.ExpectedCloseDate,
		&i.LostReason,
		&i.Source,
		&i.OwnerID,
		&i.ContactID,
		&i.CompanyID,
		&i.CampaignID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.Products,
	)
	return i, err
}
