/**
 * Auto-generated Zod schema for DeliveryManagementRoutes
 * Generated by: scripts/generate-zod-schemas.ts
 * DO NOT EDIT MANUALLY
 */

import { z } from "zod";
import { Collections } from "@/lib/pb.types";

export const RoutesSchema = z
  .object({
    id: z.string(),
    driver: z.string().optional(),
    routeDate: z.iso.date().optional(),
    status: z
      .enum(["planned", "in-progress", "completed", "cancelled", "paused"])
      .optional(),
    totalDistance: z
      .number()
      .min(0, "Total distance must be non-negative")
      .optional(),
    estimatedDurationInMinutes: z
      .number()
      .min(0, "Estimated duration must be non-negative")
      .optional(),
    startedAt: z.iso.date().optional(),
    completedAt: z.iso.date().optional(),
    created: z.iso.datetime().optional(),
    updated: z.iso.datetime().optional(),
  })
  .superRefine((data, ctx) => {
    // State Machine Constraint: Status follows lifecycle
    // planned -> in-progress -> completed
    // cancelled and paused are alternative branches
    const terminalStatuses = ["completed", "cancelled"];

    if (data.status && terminalStatuses.includes(data.status)) {
      ctx.addIssue({
        code: "custom",
        message: `Route with status '${data.status}' is in a terminal state and cannot be modified`,
      });
    }

    // Immutability: A completed route is immutable
    if (data.status === "completed" && data.completedAt) {
      console.info(
        "ğŸ”’ Route: Completed routes are immutable. Create a new route for additional deliveries."
      );
    }

    // Trigger: actualDuration should be calculated when completedAt is set
    if (data.completedAt && data.startedAt) {
      console.info(
        "â±ï¸ Route Duration: actual_duration_minutes should be auto-calculated by trigger when completed_at is set"
      );
    }
  });

export type Routes = z.infer<typeof RoutesSchema>;
