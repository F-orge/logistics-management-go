/**
 * Auto-generated Zod schema for DeliveryManagementTaskEvents
 * Generated by: scripts/generate-zod-schemas.ts
 * DO NOT EDIT MANUALLY
 */

import { z } from "zod";
import { Collections } from "@/lib/pb.types";
import { Coordinates } from "@/pocketbase/scalar";

export const TaskEventsSchema = z
  .object({
    id: z.string(),
    task: z.string(),
    status: z
      .enum([
        "assigned",
        "started",
        "arrived",
        "delivered",
        "failed",
        "exception",
        "cancelled",
        "rescheduled",
      ])
      .optional(),
    reason: z.string().optional(),
    notes: z.string().optional(),
    coordinates: Coordinates.optional(),
    timestamp: z.iso.datetime().optional(),
  })
  .superRefine((data, ctx) => {
    // Audit Trail Constraint: Task events create immutable history
    // The status in the event must sync with the parent task status
    console.info(
      "ğŸ“ Task Event: Immutable audit record. Status changes trigger automatic parent task status updates."
    );

    // Event Syncing: Each task event should trigger task status update
    if (data.status) {
      console.info(
        `ğŸ”„ Trigger: Task status should automatically update to '${data.status}' based on event record`
      );
    }
  });

export type TaskEvents = z.infer<typeof TaskEventsSchema>;
