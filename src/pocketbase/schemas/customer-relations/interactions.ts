/**
 * Auto-generated Zod schema for CustomerRelationsInteractions
 * Generated by: scripts/generate-zod-schemas.ts
 * DO NOT EDIT MANUALLY
 */

import { ClientResponseError } from "pocketbase";
import { z } from "zod";
import { Collections, TypedPocketBase } from "@/lib/pb.types";

export const InteractionsSchema = z.object({
  id: z.string(),
  contact: z.string(),
  user: z.string(),
  case: z.string().optional(),
  type: z.enum(["call", "meeting", "text", "email"]).optional(),
  outcome: z.string().optional(),
  notes: z.string().optional(),
  attachments: z.file().array().optional(),
  interactionDate: z.date().optional(),
});

export type Interactions = z.infer<typeof InteractionsSchema>;

export const CreateInteractionsSchema = (pocketbase: TypedPocketBase) =>
  InteractionsSchema.omit({
    id: true,
  }).superRefine((data, ctx) => {
    // Validate required references
    if (!data.contact) {
      ctx.addIssue({
        code: "custom",
        path: ["contact"],
        message: "Contact reference is required",
      });
    }

    if (!data.user) {
      ctx.addIssue({
        code: "custom",
        path: ["user"],
        message: "User reference is required",
      });
    }

    // Validate interaction date if provided
    if (data.interactionDate && data.interactionDate > new Date()) {
      ctx.addIssue({
        code: "custom",
        path: ["interactionDate"],
        message: "Interaction date cannot be in the future",
      });
    }
  });

export const UpdateInteractionsSchema = (pocketbase: TypedPocketBase) =>
  InteractionsSchema.partial()
    .omit({
      id: true,
      attachments: true,
    })
    .superRefine((data, ctx) => {
      // Validate interaction date if provided
      if (data.interactionDate && data.interactionDate > new Date()) {
        ctx.addIssue({
          code: "custom",
          path: ["interactionDate"],
          message: "Interaction date cannot be in the future",
        });
      }

      // Validate that notes are not empty if provided
      if (data.notes !== undefined && data.notes.trim().length === 0) {
        ctx.addIssue({
          code: "custom",
          path: ["notes"],
          message: "Interaction notes cannot be empty",
        });
      }
    });
