/**
 * Auto-generated Zod schema for CustomerRelationsOpportunityProducts
 * Generated by: scripts/generate-zod-schemas.ts
 * DO NOT EDIT MANUALLY
 */

import { z } from "zod";

export const OpportunityProductsSchema = z
  .object({
    id: z.string(),
    opportunity: z.string().optional(),
    product: z.string().optional(),
    quantity: z
      .number()
      .min(0, "Quantity must be non-negative")
      .int("Quantity must be an integer"),
    priceSnapshot: z
      .number()
      .min(0, "Price snapshot must be non-negative")
      .optional(),
    created: z.iso.datetime().optional(),
    updated: z.iso.datetime().optional(),
  })
  .superRefine((data, ctx) => {
    // Price Snapshot Constraint: When a product is added to an opportunity,
    // its price must be copied from the main product catalog at that moment in time.
    // This ensures future price changes in the catalog do not affect existing opportunities.
    if (!data.priceSnapshot && data.product) {
      ctx.addIssue({
        code: "custom",
        path: ["priceSnapshot"],
        message:
          "Price snapshot must be populated when adding a product. It will be copied from the product catalog and locked to prevent historical pricing changes.",
      });
    }

    // Immutability reminder for price snapshot
    console.info(
      "ðŸ“Œ Price Snapshot: Once set, the price snapshot for this product line item is immutable to maintain historical accuracy"
    );
  });

export type OpportunityProducts = z.infer<typeof OpportunityProductsSchema>;
