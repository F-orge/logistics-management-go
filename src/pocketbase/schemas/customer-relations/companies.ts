/**
 * Auto-generated Zod schema for CustomerRelationsCompanies
 * Generated by: scripts/generate-zod-schemas.ts
 * DO NOT EDIT MANUALLY
 */

import { ClientResponseError } from "pocketbase";
import { z } from "zod";
import { Collections, TypedPocketBase } from "@/lib/pb.types";

export const CompaniesSchema = z.object({
  id: z.string(),
  name: z.string().nonempty(),
  street: z.string().optional(),
  city: z.string().optional(),
  state: z.string().optional(),
  postalCode: z.string().optional(),
  country: z.string().optional(),
  phoneNumber: z
    .string()
    .min(7, "Phone number must be at least 7 digits")
    .max(15, "Phone number must be at most 15 characters")
    .optional(),
  industry: z.string().optional(),
  website: z
    .string()
    .refine(
      (val) =>
        val === "NA" ||
        /^(https?:\/\/)?([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}/.test(val),
      "Website must be a valid URL or 'NA'"
    )
    .optional(),
  annualRevenue: z
    .number()
    .min(0, "Annual revenue must be non-negative")
    .optional(),
  owner: z.string().optional(),
  attachments: z
    .union([z.instanceof(File), z.string()])
    .array()
    .optional(),
  created: z.iso.datetime().optional(),
  updated: z.iso.datetime().optional(),
});

export type Companies = z.infer<typeof CompaniesSchema>;

export const CreateCompaniesSchema = (pocketbase: TypedPocketBase) =>
  CompaniesSchema.omit({
    id: true,
    created: true,
    updated: true,
  }).superRefine((data, ctx) => {
    // Name is already required via nonempty() but we ensure it's enforced
    if (!data.name || data.name.trim().length === 0) {
      ctx.addIssue({
        code: "custom",
        path: ["name"],
        message: "Company name is required",
      });
    }
  });

export const UpdateCompaniesSchema = (pocketbase: TypedPocketBase) =>
  CompaniesSchema.partial()
    .omit({
      id: true,
      created: true,
      updated: true,
      attachments: true,
    })
    .superRefine((data, ctx) => {
      // If name is being updated, ensure it's not empty
      if (data.name !== undefined && data.name.trim().length === 0) {
        ctx.addIssue({
          code: "custom",
          path: ["name"],
          message: "Company name cannot be empty",
        });
      }

      // If phone number is being updated, validate format if provided
      if (
        data.phoneNumber !== undefined &&
        data.phoneNumber.trim().length > 0
      ) {
        if (data.phoneNumber.length < 7 || data.phoneNumber.length > 15) {
          ctx.addIssue({
            code: "custom",
            path: ["phoneNumber"],
            message: "Phone number must be between 7 and 15 characters",
          });
        }
      }

      // If website is being updated, validate format if provided
      if (data.website !== undefined && data.website.trim().length > 0) {
        if (
          data.website !== "NA" &&
          !/^(https?:\/\/)?([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}/.test(data.website)
        ) {
          ctx.addIssue({
            code: "custom",
            path: ["website"],
            message: "Website must be a valid URL or 'NA'",
          });
        }
      }
    });
